#buscar-site

#!/bin/bash

echo "ğŸŒ Informe o domÃ­nio para buscar (ex: meusite.4have.com.br):"
read DOMAIN

CADDY_SITES_DIR="/home/site4have/Caddy/sites"
CONF_FILE="$CADDY_SITES_DIR/$DOMAIN.conf"

if [[ ! -f "$CONF_FILE" ]]; then
  echo "âŒ Arquivo de configuraÃ§Ã£o do Caddy nÃ£o encontrado para o domÃ­nio '$DOMAIN'."
  exit 1
fi

# Tenta extrair o container do reverse_proxy
CONTAINER=$(grep reverse_proxy "$CONF_FILE" | sed -E 's/.*reverse_proxy[[:space:]]+([^:]+):.*/\1/' | head -n1)

if [[ -z "$CONTAINER" ]]; then
  echo "âš ï¸ NÃ£o foi possÃ­vel extrair o nome do container."
  exit 1
fi

SITE_NAME=${CONTAINER#wp_}
SITE_DIR="$HOME/sites/$SITE_NAME"

echo -e "\nğŸ” InformaÃ§Ãµes encontradas:"
echo "ğŸŒ DOMÃNIO.........: $DOMAIN"
echo "ğŸ“¦ CONTAINER.......: $CONTAINER"
echo "ğŸ—„ BANCO DE DADOS..: $SITE_NAME"
echo "ğŸ‘¤ USUÃRIO BD......: $SITE_NAME"
echo "ğŸ“ DIRETÃ“RIO.......: $SITE_DIR"
echo "ğŸ“ CADDY CONF......: $CONF_FILE"

# Status do container
if podman ps --format "{{.Names}}" | grep -q "^$CONTAINER$"; then
  echo "âœ… STATUS...........: Container estÃ¡ rodando"
else
  echo "â›” STATUS...........: Container parado ou inexistente"
fi

# Info extra: volume, IP e mount
echo -e "\nğŸ“¦ Detalhes adicionais:"
podman inspect "$CONTAINER" --format '
ğŸ“› Nome real: {{.Name}}
ğŸ”Œ IP interno: {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}
ğŸ—‚ Mounts:
{{range .Mounts}} - {{.Source}} â†’ {{.Destination}}{{"\n"}}{{end}}
'

echo -e "\nâš ï¸ Senha do banco nÃ£o Ã© armazenada por seguranÃ§a. Certifique-se de tÃª-la salvo no momento da criaÃ§Ã£o."
